# Veeva Vault REST API Wrapper

The purpose of this module is to make it easier to work with the Veeva Vault API.

The context at this time is primarily for CLM (IVA) presentations.

This library has been tested with [Vault API v13.0](https://developer.veevavault.com/docs/api/v13/) and [Vault API v18.3](https://developer.veevavault.com/api/18.3/).


# Requirements

You need three pieces of information to use the Vault API:

  1. Your Vault host (e.g., `https://your-assigned-agency-subdomain.veevavault.com/api/v18.3/`)
  2. A Vault API username
  3. A Vault API password

**You'll need this information when you use the `authenticate` method to begin your connection to the Vault API.**


# Installation

```bash
$ npm install
```

# Getting Started

Here's a simple example that logs in and gets a list of all products and binders.

```js
const vault = require("./veeva-vault");

vault.authenticate({
  host: "https://my-host-name.veevavault.com/api/v18.3/",
  username: "my-vault-username",
  password: "my-vault-password"
})
.then(function() {
  return vault.getProducts();
})
.then(function(products) {
  console.log("Found these products:", products);
  return vault.getBinders();
})
.then(function(binders) {
  console.log("Found these binders:", binders);
})
.then(function() {
  // Make the next API call...
})
.catch(function(e) {
  console.log("Error using Vault API:", e.message);
});
```


# API Reference

Note that each method returns a Promise object. If no other return value is specified, the method will not return anything other than the promise object.


**Authentication**
- authenticate(credentials)

**Vault Objects (e.g., Products and Countries)**
- getVaultObjects(object_type)
- getProducts()
- getCountries()

**Binders**
- getBinders()
- getBinder(binder_id)
- createBinder(binder_data)
- updateBinder(binder_id, binder_data)
- deleteBinder(binder_id)
- getBinderDocuments(binder_id)
- setBinderDocuments(binder_id, document_ids)
- removeBinderDocuments(binder_id, documents)
- removeBinderDocuments(binder_id, document_node_ids)

**Documents**
- getDocument(document_id)
- createDocument(document_data)
- updateDocument(document_id, document_data)
- updateDocumentFile(document_id, document_file)
- deleteDocument(document_id)
- lockDocument(document_id)
- unlockDocument(document_id)
- getDocumentRelationships(document)
- createDocumentRelationship(document, shared_document_id)
- removeDocumentRelationship(document, relationship_id)

**Misc**
- verbose(mode)


## authenticate(credentials)

Begin an authenticated Vault API session. This method must be called before using any other methods in this module.

**Args**

- `credentials` = object defining user credentials, e.g.:

```
{
  host: "https://my-host-name.veevavault.com/api/v18.3/",
  username: "my-vault-username",
  password: "my-vault-password"
}
```


## getVaultObjects(object_type)

Get a list of vault objects of a given type.

**Args**

- `object_type` = string of the object type to return, e.g.:
  - `product__v`
  - `country__v`
  - `study__v`

- (promise-wrapped) array of Vault objects


## getProducts()

Get a list of all products defined in our Vault.

**Returns**

- (promise-wrapped) array of product objects


## getCountries()

**Returns**

- (promise-wrapped) array of country objects


## getBinders()

Get all binders available to the current user.

**Returns**

- (promise-wrapped) array of binder objects


## getBinder(binder_id)

Retrieve a specific binder.

**Args**

- `binder_id` = the Vault ID of the binder to retrieve

**Returns**

- (promise-wrapped) binder object


## createBinder(binder_data)

Create a new binder.

**Args**

- `binder_data` = object with Vault binder key/value pairs for the new binder
- See the [Vault documentation](https://developer.veevavault.com/docs/api/v13/#CreateBinders) for possible values

**Returns**

- (promise-wrapped) binder object


## updateBinder(binder_id, binder_data)

Update values for a specific binder.

**Args**

- `binder_id` = the Vault ID of the binder to retrieve
- `binder_data` = object with Vault binder key/value pairs to update


## deleteBinder(binder_id)

Delete the specified binder. Note that we cannot delete a binder that has documents assigned to it.

**Args**

- `binder_id` = the Vault ID of the binder to delete


## getBinderDocuments(binder_id)

Get all documents that are contained within the given binder. Documents are returned in the same order that they are shown within the binder.

**Args**

- `binder_id` = the Vault ID of the binder to get documents for

**Returns**

- (promise-wrapped) array of document reference objects
- each object looks like:

```
{
  node_id: string value representing a document reference (used to remove references in a binder)
  document_id: the Vault ID of the document being referenced
}
```

## setBinderDocuments(binder_id, document_ids)

Define the documents to be contained within the given binder. Documents will be ordered the same way they are given in the `document_ids` array.

**Args**

- `binder_id` = the Vault ID of the binder to get associated documents for
- `document_ids` = array of Vault document IDs to associate with this binder


## removeBinderDocuments(binder_id, documents)

Remove the given documents from the specified binder.

**Args**

- `binder_id` = the Vault ID of the binder to remove documents from
- `documents` = array of document objects, as returned from `getBinderDocuments()`


## removeBinderDocuments(binder_id, document_node_ids)

This is an alternate signature for `removeBinderDocuments()` that allows you to just pass an array of document_node_ids instead of requiring document objects.

**Args**

- `binder_id` = the Vault ID of the binder to remove documents from
- `documents` = array of document reference node_id values



## getDocument(document_id)

Retrieve a specific Vault document.

**Args**

- `binder_id` = the Vault ID of the document to retrieve

**Returns**

- (promise-wrapped) document object


## createDocument(document_data)

Create a new Vault document. Note that if a file is specified, the file will be uploaded at this time.

**Args**

- `document_data` = object with Vault key/value pairs for the new document

**Returns**

- Vault ID of the newly created document


## updateDocument(document_id, document_data)

Update values for a specific Vault document.

Note that we cannot update a ZIP file associated with the document with this method. Use `updateDocumentFile()` instead.

**Args**

- `document_id` = the Vault ID of the document to update
- `document_data` = object with Vault key/value pairs to update

**Returns**

- (promise-wrapped) Vault ID of the document that was updated


## updateDocumentFile(document_id, document_file)

Update the ZIP file assigned to a specific Vault document.

Note that this method should only be used to update the ZIP file and not any other properties.

**Args**

- `document_id` = the Vault ID of the document to update
- `document_file` = a file stream @todo


## deleteDocument(document_id)

Delete the specified document from the Vault. This includes all versions of the document, including source files and renditions.

Note that we cannot delete a document that is currently assigned to a binder.

**Args**

- `document_id` = the Vault ID of the document to delete


## lockDocument(document_id)

Lock / check-out a specific Vault document.

**Args**

- `binder_id` = the Vault ID of the document to lock


## unlockDocument(document_id)

Unlock / check-in a specific Vault document.

**Args**

- `document_id` = the Vault ID of the document to unlock


## getDocumentRelationships(document)

Get the Vault documents that are associated with another Vault document.

**Args**

- `document` = object, e.g.:

```
{
  id: int id of the Vault document we're getting content relationships for
  version_major: int major version number of the document we're getting info for
  version_minor: int minor version number of the document we're getting info for
}
```

**Returns**

- array of relationship objects, e.g.

```
[
  {
    relationship:
      {
        id: relationship_id for this relationship
        ...
      }
  },
  { ... }
]
```



## createDocumentRelationship(document, shared_document_id)

Make a Vault document a shared resource of another Vault document.

**Args**

- `document` = object, e.g.:

```
{
  id: int id of the Vault document we're updating
  version_major: int major version number of the document we're updating
  version_minor: int minor version number of the document we're updating
}
```
- `shared_document_id` = int id of the Vault document we're associating with the main document


## removeDocumentRelationship(document, relationship_id)

Remove the association between one Vault document and another.

**Args**

- `document` = object, e.g.:

```
{
  id: int id of the Vault document we're updating
  version_major: int major version number of the document we're updating
  version_minor: int minor version number of the document we're updating
  relationship_id: int id of the shared document relationship to remove
}
```
- `relationship_id` = int id of the shared document relationship to remove


## verbose(show_messages)

Configure the module to be chatty (display status messages) or be quiet.

**Args**

- `show_messages` = boolean




# Background: Vault Object Types and Relationships

For this wrapper, we're primarily concerned with Vault `binders` and `documents`.

We also provide methods for retrieving Vault defined `products` and `countries`.

![](/docs/vault-relationships.png)

- [Diagram source](https://docs.google.com/drawings/d/10vMfED_ieLwPKwIcF49hB2lFB-Wjo47KXi13ZhtmWN4/edit)


## Binders

A Vault `binder` is used to define a presentation. The binder contains references to `documents` including the order in which they should be displayed.

A `binder` doesn't contain the actual `document` data. It contains a *reference* to the `document`.


## Documents

A document can:

  - Have an associated file (e.g., a ZIP file which contains an HTML IVA slide contents)
  - Have a related shared resource (e.g., a reference to another document that will be available when this document is shown)
  - Be locked or unlocked (in the Vault UI this refers to "Check Out" and "Check In")


## Products

Binders and documents are associated with specific `products`. The `product` is the drug brand that the `binder` and `document` material is for.


# Links

- [Vault API documentation v13.0](https://developer.veevavault.com/docs/api/v13/)
- [Vault API documentation v18.3](https://developer.veevavault.com/api/18.3/)
- [SmartRep code](https://github.com/KlickCommander/klick-smartrep)
- [Jayvin's Approved Email prototype](https://drive.google.com/drive/folders/169a5cAGBv-NVIdY-8GxMvjMTQGpgkmpg)


# Release History

- v0.1.1 (2019-03-25)
  - Initial working version

- v0.1.0 (2019-03-15)
  - Work in progress


