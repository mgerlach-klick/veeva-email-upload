"use strict";

/*
 * @file
 * example.create-remove-document.js
 *
 * Requirements:
 * - create a file "credentials.json" similar to the following:
 *
 *   {
 *     "host": "https://your-agency-subdomain.veevavault.com/api/v18.3/",
 *     "username": "my-username@vv-agency.com",
 *     "password": "my-password"
 *   }
 *
 * This example demonstrates:
 * - authenticating to the Veeva API
 * - creating a new document
 * - deleting the document
 */

const fs = require("file-system");

const vault = require("../veeva-vault");

var secret = JSON.parse(fs.readFileSync("credentials.json", "utf8"));

vault.verbose(true);

vault
  .authenticate({
    host: secret.host,
    username: secret.username,
    password: secret.password
  })
  .then(function() {
    // Create a new document.
    var document_data = {
      name__v: "My example document name",
      type__v: "Multichannel Slide",
      status__v: "Draft",
      clm_content__v: "Yes",
      lifecycle__v: "CRM Content Lifecycle",
      major_version_number__v: "0",
      minor_version_number__v: "1",
      product__v: "00P000000000701", // Rellyant
      country__v: "unitedStates"
    };
    return vault.createDocument(document_data);
  })
  .then(function(document_id) {
    console.log("\nCreated document: " + document_id);

    // Get the document, as built.
    return vault.getDocument(document_id);
  })
  .then(function(document) {
    console.log("\nDocument created:\n", document);

    // Delete the document we created.
    return vault.deleteDocument(document.id);
  })
  .catch(function(e) {
    console.log("\n\nError somewhere...:", e.message);
  });
